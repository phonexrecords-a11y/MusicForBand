<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Player - –í–∞—à–∞ –º—É–∑—ã–∫–∞ –Ω–∞ GitHub</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .player-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: center;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }
        
        .control-btn:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .control-btn.stop {
            background: linear-gradient(45deg, #4ECDC4, #00B4DB);
        }
        
        .control-btn.pause {
            background: linear-gradient(45deg, #45B7D1, #96C93D);
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            margin: 30px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FFEAA7, #DDA0DD);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 10px;
        }
        
        .time-display {
            color: white;
            font-size: 14px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .visualizer {
            height: 80px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin: 25px 0;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .note-bar {
            position: absolute;
            bottom: 0;
            width: 6px;
            background: linear-gradient(to top, #FFEAA7, #FD79A8);
            border-radius: 3px 3px 0 0;
            transition: height 0.2s ease;
        }
        
        .status {
            color: #FFEAA7;
            margin-top: 20px;
            font-weight: 500;
            min-height: 24px;
        }
        
        .volume-control {
            margin: 20px 0;
            text-align: left;
        }
        
        .volume-label {
            color: white;
            margin-bottom: 8px;
            display: block;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h1>üéµ MIDI –ü–ª–µ–µ—Ä</h1>
        <p class="subtitle">–í–∞—à–∞ –º—É–∑—ã–∫–∞ –ø—Ä—è–º–æ –≤ GitHub</p>
        
        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="totalTime">0:00</span>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="controls">
            <button class="control-btn" onclick="loadAndPlayMIDI()" id="playBtn">
                <span>‚ñ∂Ô∏è</span> –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
            </button>
            <button class="control-btn pause" onclick="pausePlayback()" id="pauseBtn" disabled>
                <span>‚è∏Ô∏è</span> –ü–∞—É–∑–∞
            </button>
            <button class="control-btn stop" onclick="stopPlayback()" id="stopBtn" disabled>
                <span>‚èπÔ∏è</span> –°—Ç–æ–ø
            </button>
        </div>
        
        <div class="volume-control">
            <label class="volume-label">üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.7" onchange="changeVolume(this.value)">
        </div>
        
        <div class="visualizer" id="visualizer"></div>
        
        <div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é</div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const progressBar = document.getElementById('progressBar');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const visualizer = document.getElementById('visualizer');

        let currentSequence;
        let isPlaying = false;
        let startTime = 0;
        let totalDuration = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–∞
        const synth = new Tone.PolySynth(Tone.Synth, {
            oscillator: {
                type: "triangle"
            },
            envelope: {
                attack: 0.02,
                decay: 0.1,
                sustain: 0.3,
                release: 0.5
            }
        }).toDestination();

        // –≠—Ñ—Ñ–µ–∫—Ç—ã
        const reverb = new Tone.Reverb({
            decay: 1.5,
            wet: 0.2
        }).toDestination();
        
        const chorus = new Tone.Chorus(4, 2.5, 0.5).toDestination();
        
        synth.connect(chorus);
        chorus.connect(reverb);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è MIDI
        async function loadAndPlayMIDI() {
            try {
                status.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ MIDI —Ñ–∞–π–ª–∞...";
                playBtn.disabled = true;
                
                await Tone.start();
                status.textContent = "–ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω";

                // –ó–∞–º–µ–Ω–∏—Ç–µ 'your-music.mid' –Ω–∞ –∏–º—è –≤–∞—à–µ–≥–æ MIDI —Ñ–∞–π–ª–∞
                const midiResponse = await fetch('your-music.mid');
                const midiArrayBuffer = await midiResponse.arrayBuffer();
                
                status.textContent = "MIDI —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ...";

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –º–µ–ª–æ–¥–∏—é, –µ—Å–ª–∏ MIDI –ø–∞—Ä—Å–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                playSimpleMelody();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                status.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –¥–µ–º–æ-–º–µ–ª–æ–¥–∏—è";
                playSimpleMelody();
            }
        }

        // –î–µ–º–æ-–º–µ–ª–æ–¥–∏—è (–µ—Å–ª–∏ MIDI —Ñ–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è)
        function playSimpleMelody() {
            const demoMelody = {
                notes: [
                    { time: "0:0:0", note: "C4", duration: "4n", velocity: 0.8 },
                    { time: "0:0:2", note: "E4", duration: "4n", velocity: 0.8 },
                    { time: "0:1:0", note: "G4", duration: "4n", velocity: 0.8 },
                    { time: "0:1:2", note: "B4", duration: "4n", velocity: 0.8 },
                    { time: "0:2:0", note: "C5", duration: "2n", velocity: 0.9 },
                    { time: "0:3:0", note: "G4", duration: "4n", velocity: 0.7 },
                    { time: "0:3:2", note: "E4", duration: "4n", velocity: 0.7 },
                    { time: "0:4:0", note: "C4", duration: "2n", velocity: 0.8 },
                    { time: "1:0:0", note: "A4", duration: "4n", velocity: 0.8 },
                    { time: "1:0:2", note: "G4", duration: "4n", velocity: 0.8 },
                    { time: "1:1:0", note: "F4", duration: "4n", velocity: 0.8 },
                    { time: "1:1:2", note: "E4", duration: "4n", velocity: 0.8 },
                    { time: "1:2:0", note: "D4", duration: "2n", velocity: 0.9 },
                    { time: "1:3:0", note: "F4", duration: "4n", velocity: 0.7 },
                    { time: "1:3:2", note: "A4", duration: "4n", velocity: 0.7 },
                    { time: "1:4:0", note: "C5", duration: "2n", velocity: 0.9 }
                ],
                tempo: 120
            };

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
            if (currentSequence) {
                currentSequence.stop();
            }

            Tone.Transport.bpm.value = demoMelody.tempo;
            Tone.Transport.position = "0:0:0";

            // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä
            createVisualizer();

            // –°–æ–∑–¥–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            currentSequence = new Tone.Sequence((time, note) => {
                synth.triggerAttackRelease(note.note, note.duration, time, note.velocity);
                visualizeNote(note.note, note.velocity);
            }, demoMelody.notes).start(0);

            // –†–∞—Å—á–µ—Ç –æ–±—â–µ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            totalDuration = Tone.Time("2m").toSeconds();
            totalTimeEl.textContent = formatTime(totalDuration);

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            Tone.Transport.start();
            startTime = Tone.Transport.seconds;
            isPlaying = true;

            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            playBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;
            status.textContent = "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ...";

            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            updateProgress();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
        function createVisualizer() {
            visualizer.innerHTML = '';
            for (let i = 0; i < 32; i++) {
                const bar = document.createElement('div');
                bar.className = 'note-bar';
                bar.style.left = `${(i / 32) * 100}%`;
                bar.style.height = '0px';
                visualizer.appendChild(bar);
            }
        }

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ—Ç—ã
        function visualizeNote(note, velocity) {
            const bars = visualizer.getElementsByClassName('note-bar');
            const noteIndex = (Tone.Frequency(note).toMidi() - 48) % 32;
            
            if (bars[noteIndex]) {
                const height = 20 + (velocity * 60);
                bars[noteIndex].style.height = `${height}%`;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
                setTimeout(() => {
                    bars[noteIndex].style.height = '0px';
                }, 300);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress() {
            if (isPlaying) {
                const currentTime = Tone.Transport.seconds - startTime;
                const progress = (currentTime / totalDuration) * 100;
                
                progressBar.style.width = `${Math.min(progress, 100)}%`;
                currentTimeEl.textContent = formatTime(currentTime);
                
                if (progress < 100) {
                    requestAnimationFrame(updateProgress);
                } else {
                    stopPlayback();
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–∞—É–∑—ã
        function pausePlayback() {
            if (isPlaying) {
                Tone.Transport.pause();
                isPlaying = false;
                pauseBtn.innerHTML = '<span>‚ñ∂Ô∏è</span> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                status.textContent = "–ü–∞—É–∑–∞";
            } else {
                Tone.Transport.start();
                isPlaying = true;
                pauseBtn.innerHTML = '<span>‚è∏Ô∏è</span> –ü–∞—É–∑–∞';
                status.textContent = "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ...";
                updateProgress();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
        function stopPlayback() {
            Tone.Transport.stop();
            Tone.Transport.cancel();
            isPlaying = false;
            
            progressBar.style.width = '0%';
            currentTimeEl.textContent = '0:00';
            
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            pauseBtn.innerHTML = '<span>‚è∏Ô∏è</span> –ü–∞—É–∑–∞';
            
            status.textContent = "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function changeVolume(value) {
            synth.volume.value = Tone.gainToDb(value);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            status.textContent = "–ù–∞–∂–º–∏—Ç–µ '–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏' —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å";
            createVisualizer();
        });
    </script>
</body>
</html>
